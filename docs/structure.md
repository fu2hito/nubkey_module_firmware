# nubkey_module　を使用する上での基礎知識
<br><br>
nubkey_module を使用したキーボードを作成する人も設計する人もどういう仕組みで動いている物なのか確認してからのご使用をお願いします。<br>
とても繊細な仕組みの元成り立っている技術なので、設計の仕方、組み立て方次第で操作感に影響が出ます。<br>
<br><br>


## 構造の説明
<br>


![pcb](/images/danmen_1.png)

<br>

### KS-20とホールセンサーの位置が最も重要
KS-20の中心位置と十字に並ぶホールセンサーの中心の位置がピッタリ合っているほど操作しやすくなります。<br>
位置が0.1mmズレるだけで特定の方向にだけにマウス移動する速度が遅くなったり、ひどい場合はマウスが勝手に移動してしまうなどの現象が起こります。<br>
多少であればキャリブレーションを行う事で調節できますが、使っているウチに振動でトッププレートが沈んだり、たわみでKS-20の位置とホールセンサーの位置がズレたりすると定期的にキャリブレーションを行わなければならず不便な物になってしまいます。<br>

<br><br>

### KS-20 は浮いています
NubkeyとなるKS-20はトッププレートに支えられているのみで浮いています。<br>
通常の電気接点のあるMXスイッチであれば多少ソケットから抜けたり斜めに刺さってしまっても動作しますが、Nubkeyはマウスの操作に影響が出てしまいます。<br>
なので 「KS-20→トッププレート→PCB→nubkey_module」 までの間がシッカリ固定されて動かないようになっている必要があります。<br>

<br><br>

### nubkey_module のはんだづけ
PCBに nubkey_module をはんだ付けする際はシッカリとPCBと密着して隙間が無い状態にして下さい。<br>
ここで隙間ができるとKS-20と水平にならなくなってしまい操作感に影響が出る可能性があります。<br>

<br><br>
<br><br>

## キャリブレーションについて
<br>

### 磁石の中心位置
<img src="/images/hall_1.png" width="500"><br>
<br>
磁石の中心位置が最も磁力線が強くなっていて、この位置が上下左右に動いた事をホールセンサーで感知してマウスを上下左右に動かしています。<br>
KS-20の軸ブレで移動する範囲が丁度十字に並んだホールセンサーの中心にあるとどの方向に移動しても均一に移動を感知できるので、操作感が良くなります。<br>
<br>

### 中心位置がズレると何が起こるか
<img src="/images/hall_2.png" width="500"><br>
<br>
KS-20の軸ブレの中心位置がズレると、十字に並んだホールセンサー上での移動できる範囲が変わります。<br>
デフォルトのままだと十字の中心位置がNubkeyの中心と設定してあるので、キーを押しただけで左上の方へマウス移動してしまい操作感が悪くなります。<br>
<br>


### キャリブレーション
0.1mmのズレで操作感が変わってしまうので、例えばトッププレートを外してもう一度付け直しただけでネジ穴の遊び(隙間)分KS-20の中心位置が移動したりします。<br>
なのでキャリブレーションボタンを押したままKS-20をグリグリする事で、現在軸ブレはどの範囲まで移動できるかをnubkey_moduleに確認させる事ができます。<br>
そうする事で軸ブレの中心位置を設定し、マウスが特定方向にだけ動きにくくなる事を修正できます。<br>
<br>


### キャリブレーションは完璧ではない
中心位置の調整はキャリブレーションで行えるのですが、軸ブレの中心位置がズレていた場合に特定の方向のホールセンサーからの距離が遠くなってしまうと、その方向への数値の取得が小さくなります。<br>
例えば左に行く時はちょっと倒すとゆっくり動く、いっぱい倒すと早く動くの調節が利くけど、右に倒す時はちょっと倒しただけで早く動いてしまうなどの現象が起こります。<br>
nubkey_moduleに特定のI2Cコマンドを投げる事で上下左右の移動速度を設定できるようにして、ある程度は調節できるようにしてありますが都度調節はなかなか難しいので設計時、組み立てる時にnubkey_moduleやプレートにズレが発生しない様に気を付けて下さい。<br>

<br><br>
<br><br>

## トッププレートとPCBの固定方法
<br>
上記で説明してきた通りトッププレートとPCBがシッカリ固定されている事が快適にNubkeyを操作するにあたってとても重要です。<br>
固定方法について良かったパターン悪かったパターンを紹介します。<br>
<br>

<table>
<tr>
<td><img src="/images/ok_1.png"></td>
<td>
<b>トッププレートとPCBをスペーサーで固定する</b><br>
かなり確実なパターンで、スペーサーで固定しているのでズレが発生してもネジを外してトッププレートを付け直す事で調整できます。<br>
ただネジで止める箇所が遠かったり、止める数が少なかったりした場合他のMXスイッチのせいで高さに隙間ができたり、PCBのたわみで位置ズレ高さズレが発生する可能性があるので、Nubkeyの近く数か所で固定するのが良さそうです。<br>
長く使用した場合にネジのゆるみなどで固定が甘くならないかの心配は少しあります。
</td>
</tr>
<tr>
<td><img src="/images/ok_2.png"></td>
<td>
<b>2mm＋3mmトッププレートで、他のMXスイッチは直はんだ</b><br>
一番確実なパターンで、5mmのプレートを他のMXスイッチで挟んでPCBに完全に固定します。<br>
なので使用するにあたって一度位置調整すれば位置ズレが発生する事がありません。
</td>
</tr>
<tr>
<td><img src="/images/ng_1.png"></td>
<td>
<b>トッププレートが浮いているパターン</b><br>
トッププレートがMXスイッチの爪で固定されているだけなので、使用している間に爪が外れやすくなったりPCBのたわみで簡単に位置ズレが発生すると思われます。<br>
ただし全く使えないというわけでは無いので定期的にキャリブレーションや速度調整をする前提であれば一度試してみるのはありだと思います。<br>
</td>
</tr>
<tr>
<td><img src="/images/ng_2.png"></td>
<td>
<b>PCBがホットスワップで支えられてるだけで浮いてる</b><br>
ホットスワップは使用しているウチに抜けたり浮いたりし易いので、この構造だと簡単に位置ズレが発生すると思われます。<br>
どこかでトッププレートからPCBまでネジなどで固定できると良いかもしれません。（アクリルもPCBもたわみが発生するので近くで数か所が望ましいです）
</td>
</tr>
</table>

<br><br>


